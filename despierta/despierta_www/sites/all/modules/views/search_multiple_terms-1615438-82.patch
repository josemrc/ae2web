From 00e14671cd04d53bb5c33ec9e370c357b03ae2a7 Mon Sep 17 00:00:00 2001
From: Djungle Labs <djungle@59123.no-reply.drupal.org>
Date: Fri, 2 Oct 2015 15:20:36 -0400
Subject: [PATCH] Search terms: nodes dont appear when using multiple arguments
 #1615438

---
 modules/search/views_handler_argument_search.inc | 2 +-
 modules/search/views_handler_filter_search.inc   | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/modules/search/views_handler_argument_search.inc b/modules/search/views_handler_argument_search.inc
index f0a4a44..959a25a 100644
--- a/modules/search/views_handler_argument_search.inc
+++ b/modules/search/views_handler_argument_search.inc
@@ -56,7 +56,7 @@ class views_handler_argument_search extends views_handler_argument {
       $join->construct('search_total', $search_index, 'word', 'word');
       $search_total = $this->query->add_relationship('search_total', $join, $search_index);
 
-      $this->search_score = $this->query->add_field('', "SUM($search_index.score * $search_total.count)", 'score', array('aggregate' => TRUE));
+      $this->search_score = $this->query->add_field('', "$search_index.score * $search_total.count", 'score', array('aggregate' => TRUE, 'function' => 'sum'));
 
       if (empty($this->query->relationships[$this->relationship])) {
         $base_table = $this->query->base_table;
diff --git a/modules/search/views_handler_filter_search.inc b/modules/search/views_handler_filter_search.inc
index 16515a7..0b93031 100644
--- a/modules/search/views_handler_filter_search.inc
+++ b/modules/search/views_handler_filter_search.inc
@@ -150,7 +150,7 @@ class views_handler_filter_search extends views_handler_filter {
         $join->construct('search_total', $search_index, 'word', 'word');
         $search_total = $this->query->add_relationship('search_total', $join, $search_index);
 
-        $this->search_score = $this->query->add_field('', "SUM($search_index.score * $search_total.count)", 'score', array('aggregate' => TRUE));
+        $this->search_score = $this->query->add_field('', "$search_index.score * $search_total.count", 'score', array('aggregate' => TRUE, 'function' => 'sum'));
       }
 
       if (empty($this->query->relationships[$this->relationship])) {
-- 
1.9.5.msysgit.0

